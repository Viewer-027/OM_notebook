# Shell

## day01

***\*查看linux系统的解释器\**** 

```bash
cat /etc/shells

/test.sh			#会创建子进程来执行，执行后退出（需要执行权限）
bash  /test.sh		#会创建子进程来执行，执行后退出
source  /test.sh	#不会创建子进程
.  /test.sh     	#不会创建子进程
```

***\*运算工具：\****

```bash
整数运算工具:$(( ))、$[ ]、let

小数运算工具:bc
echo "scale=2;10/3" | bc  #scale可以定义结果是小数点后多少位
```

***\*export命令：\****

```bash
-f：导出函数。

-n：取消导出。

-p：列出所有已导出的变量。
```

***\*变量类型：\****

- 环境变量：变量名通常大写，又系统维护，用来设置工作环境，只有个别变量用户可以直接更改 ##环境变量：PS1  #一级提示符
- 位置变量：bash内置，存储执行脚本时提供的参数
- 预定义变量：bash内置，一类有特殊用途的变量，可直接调用但不能直接赋值或修改
- 自定义变量：又用户设置、修改及使用

***\*位置变量例子：\****

```bash
echo $0          #脚本的名称
echo $1          #第一个参数
echo $2          #第二个参数
echo $*          #所有参数
echo $#          #所有参数的个数(参数有几个)
echo $$          #执行脚本的进程号（或者说当前进程的进程号）
```

 

**使用反撇号或$()时，可以将命令执行的结果作为字符串存储**

**回显功能关闭（stty -echo），将回显功能恢复（stty echo）**

```bash
[root@nsd2502 ~]# logger hello
[root@nsd2502 ~]# tail -1 /var/log/messages
Apr  1 10:54:12 nsd2502 root[4984]: hello
```

 

 

## day02 03 条件 循环

**字符串比较**

**判断变量是否为空**

```bash
[ 操作符 字符串 ]
-z 字符串的值为空
-n 字符串的值不为空（相当于! -z）
```

**判断****字符串是否相等**

```bash
[ "$a" == "$b" ] && echo Y || echo N
[ "$a" != "$b" ] && echo Y || echo N
```

 

**单引号会屏蔽所有特殊字符的效果**

**双引号不会屏蔽特殊字符的效果**

 

***\*识别文件/目录的状态\****

**参数**	  **说明**

```bash
-e 对象名	如果对象存在则为真
-r 对象名	如果对象存在且可读则为真
-w 对象名	如果对象存在且可写则为真
-x 对象名	如果对象存在且可执行则为真
-s 对象名	如果对象存在且至少有一个字符则为真
-d 对象名	如果对象存在且为目录则为真
-f 对象名	如果对象存在且为普通文件则为真
-c 对象名	如果对象存在且为字符型特殊文件则为真
-b 对象名	如果对象存在且为块特殊文件则为真
```

 

```bash
exit结束循环以及整个脚本
break可以结束整个循环
continue结束本次循环，进入下一次循环
```

 

**case基本格式**

```bash
read -p "请输入一个字符：" key
case $key in
a)
 echo "输入的是a";;
b)
 echo "输入的是b";;
*)
 echo "输入的不是a或者b";;
esac
```

 

***\*字符串处理\****

- **1）从左向右，最短匹配删除，格式：${变量名#*关键词}**
- **2）从左向右，最长匹配删除，格式：${变量名##*关键词}**
- **3）从右向左，最短匹配删除，格式：${变量名%关键词*}**
- **4）从右向左，最长匹配删除，格式：${变量名%%关键词*}**

***\*字符串初值的处理\****

1）<u>***只取值，${var:-word}，若变量var已存在且非空，则返回 $var 的值；否则返回字串“word”，原变量var的值不受影响。***</u>



 

## day04 05 grep、sed、awk

***\*基本正则列表\****

| 正则符号  | 描述                                     |
| --------- | ---------------------------------------- |
| ^         | 匹配行首                                 |
| $         | 匹配行尾                                 |
| []        | 集合，匹配集合中的任意单个字符           |
| [^]       | 对集合取反                               |
| .         | 匹配任意单个字符                         |
| *         | 匹配前一个字符任意次数 [*不允许单独使用] |
| \\{n,m\\} | 匹配前一个字符n到m次                     |
| \\{n\\}   | 匹配前一个字符n次                        |
| \\{n,\\}  | 匹配前一个字符n次及以上                  |
| \\(\\)    | 组合为整体，保留                         |



***\*扩展正则列表\****

| ***\*正则符号\**** | ***\*描述\****       |
| ------------------ | -------------------- |
| +                  | 最少匹配一次         |
| ？                 | 最多匹配一次         |
| {n,m}              | 匹配前一个字符n到m次 |
| ()                 | 组合为整体，保留     |
| \|                 | 或者                 |
| \b                 | 单词边界             |

 

***\*egrep 命令\****

```bash
-r -R #递归目录
-i	#忽略大小写
-l 	#只打印文件名
```

 

***\*sed文本处理工具的用法：\****

用法1：前置命令 | sed [选项] '条件指令'

用法2：sed [选项] '条件指令' 文件.. ..

***\*sed命令的常用选项如下：\****

```bash
-n（屏蔽默认输出，默认sed会输出读取文档的全部内容）
-r（支持扩展正则）
-i（修改源文件）
#条件可以是行号或者/正则/，没有条件时默认为所有行都执行指令，指令可以是p输出、d删除、s替换

sed -n '1p' user        #输出第1行
sed '2s/2017/6666/g' shu.txt  #第2行的所有2017都替换成6666
sed 's/2017/6666/2' shu.txt   #把所有行的第2个2017替换成6666
sed -i '/^Listen/s/80/82/' /etc/httpd/conf/httpd.conf    #修改配置文件
```

 

```bash
a：append 行后追加
i：insert 行前插入
c：替换，替换一行内容
[root@sv7 ~]# sed '1a xx' user
root:x:0:0:root:/root:/bin/bash
xx
```

 

***\*awk\*******\*命令\****

```bash
格式1：awk [选项] '[条件]{指令}' 文件

格式2：前置指令 | awk [选项] '[条件]{指令}'

awk -F',' '{print $1, $2}' file    # -F 指定分隔符
```

***\*awk常用内置变量：\****

```bash
$0  文本当前行的全部内容
$1  文本的第1列
$2  文件的第2列
$3  文件的第3列，依此类推
NR  文件当前行的行号
NF  文件当前行的列数（有几列）
```

 

```bash
awk 'BEGIN{a["abc"]="tom";a["xyz"]="jim";for(i in a){print i,a[i]}}'

awk '{ip[$1]++}END{for(i in ip){print ip[i],i}}' log.txt | sort -nr
```

 

 

***\*.bash_profile文件中定义的TMOUT变量有什么作用\*******\*：\****

定义ssh登陆超时时间，单位是秒

***\*<、<<各自的作用\*******\*：\****

< 输入重定向，后面需要跟文件名，不再从键盘读取数据，而是从文件中读取数据

<< 也称Here Document 代表需要的内容在这里，某指令导入字符串时使用，无需文件

***\*安装\*******\*mail相关软件\****

```bash
[root@sv7 ~]# yum -y install postfix mailx
[root@sv7 ~]# systemctl start postfix
[root@sv7 ~]# mail -s test root   #ctrl +d 结束
```

***\*命令使用例子：\****

```bash
while read a b 
do
  echo  $a  $b
done < abc.txt   

[root@sv7 ~]# mail -s test root << EOF
hello
test mail~
EOF
```

 

***\*生成加密字符的方法之一：\****

```bash
/dev/urandom可以获得取之不尽的随机字符，在获取密码的场合可以使用
strings /dev/urandom  #strings类似于cat，看这个urandom中的内容

tr -cd '_a-zA-Z0-9' < /dev/urandom | head -c 10  #-c是取反 -d是删除，删除的是从/dev/urandom中导入的数据；也就是删除的是_a-zA-Z0-9；但是-c是取反，对_a-zA-Z0-9取反删除，即就只是_a-zA-Z0-9这个范围内的字符串，head -c 10 可以得到10个字符

文件选择功能的--exclude对不需要文件进行排除：
tar -cf test.tar --exclude=*.txt  /test 
```

