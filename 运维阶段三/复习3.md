# automation











# CLUSTER

集群目的：提高性能、降低成本、提高可拓展性、增强可靠性

集群分类：

HA（高可用）

LB（负载均衡）

HPC（高性能）



LVS集群组成：

前端：负载均衡层

中间：服务器群组层

底端：数据共享存储层



DS：调度服务器（安装ipvsadm、创建虚拟服务器并加入节点）

RS：真实服务器

vip： 虚拟ip

DIR：调度器ip地址

RIP：真实ip地址



lvs-nat： 地址转换实现

lvs-dr：  vrrp路由技术实现

lvs-tun：隧道方式实现虚拟服务器



lvs调度算法

- 轮询
- 加权
- 最少连接（当连接数相同时，采用加权轮询算法）
- 加权最少连接

其他调度算法

- 源地址散列

- 目标地址散列
- 基于局部性的最少链接
- 带复制的基于局部性最少链接
- 最短的期望的延迟
- 最少队列调度



ipvsadm

```bash
-A  #添加虚拟服务器
-t	#设置群集地址
-s	#指定负载调度算法
-------------------
-a  #添加真实服务器
-d  #删除真实服务器
-r 	#指定真实服务器地址
-m	#使用nat模式，-g dr模式，-i tun模式
-w  #节点服务器设置权重，默认为1
```

配置LVS调度器

打开ip_forward

```bash
#vim /etc/sysctl.conf
net.ipv4.ip_forward = 1
# sysctl -p
```

内核参数说明

```
arp_ignore
-0(默认)
回应所用的本地地址ARP广播，本地地址可以配置在任意网络接口
-1
只回应配置在入站网卡接口上的任意ip地址的arp广播

arp_announce
-0(默认)
使用配置在任意网卡接口上的本地ip地址
-2
对查询目标使用最适当的本地地址，在此模式下回忽略这个ip数据包的源地址并尝试选择与该地址通行的本地地址
```













HAProxy工作模式

- mode http
  - 客户端请求被深度分析后在发往服务器
- mode tcp
  - 4层调度，不检查第七层信息
- mode health
  - 仅做健康状态检查，已经不建议使用

haproxy配置文件

/etc/haproxy/haproxy.cfg

```yaml
pidfile  /var/run/haproxy.pid		####haproxy的pid存放路径
maxconn 4000    ####最大连接数


```



#### Ceph特点

每个组件皆可扩展

- 集群管理节点可以扩展

- 集群存储节点可以扩展

基于软件实现

- 可以使用现有设备

EB级存储

默认3副本

- 自动复制、平衡设备



**Ceph组件**

OSDs（ceph-osd）

-存储设备

Monitors （ceph-mon）

-集群监控组件

MDSs（ceph-mds）

-存放文件系统的元数据（对象存储和块存储不需要该主键）

管理器：CephManager

-负责跟踪ceph集群的运行时指标和当前状态，包括存储利用率、当前性能指标和系统负载



块存储

- 单机块设备

​      -光盘

​	  -磁盘

- 分布式块存储

  - Ceph
  - Cinder

  

```bash
# 查看镜像快照
rbd snap ls img1
#创建镜像快照
rbd snap create img1 --snap img1-sn1

# 还原快照
rbd snap rlloback img1 --snap img1-sn1
# 挂载分区
rbd map img1
```





# SECURITY

### zabbix

监控目的：吞吐量、反应时间、使用率

监控资源：

公开数据：

- Web、FTP、ssh、数据库

- TCP或UDP端口

私有数据：

- cpu、内存、磁盘、网卡流量

- 用户、进程等运行信息





系统监控命令：

ps						ifconfig

uptime				netstat 或 ss

free					  ping

swapon -s		   traceroute

df -h					 iostat

查看：

free -m

top htop

交换分区：

swapon -s

free -m

查看磁盘信息：

df -h

lsblk

查看CPU信息：

lscpu

cat /proc/cpuinfo

查看网卡信息：

查看端口信息：

查看网络连接信息：



### prometheus

prometheus的端口号9090

node_exporter端口号9100

mysqld_expoter端口号9104

grafana端口号3000

Altermanager的端口号9093



Alertmanager管理告警，包括静默、抑制、分组以及通过电子邮件、即时消息系统和聊天平台发出通知

全局配置（global）：定义全局公共参数

模板（templates）：定义告警通知时的模板

告警路由（route）：根据标签匹配，确定当前告警如何处理

接收器（receivers）：接收器是一个抽象的概念，它可以是邮箱、微信、Slack、webhook，配合告警路由使用

抑制规则（inhibit_rules）: 合理设置抑制规则可以减少垃圾告警的产生





### Kail

基于Debian的linux发行版

扫描作用

检测潜在的风险

查找可攻击的目标

搜集设备/主机/系统/软件信息

发现可利用的安全漏洞



扫描方式

-Scan，主动探测

-Sniff，被动监听/嗅探

-Capture,数据包捕获

安全分析工具

-扫描器：NMAP

-协议分析：tcpdump、wireshark



NMAP简介

-ping

-多端扫描

-tcp/ip指纹校验



扫描类型

-sS ， TCP SYN扫描

-sT，  TCP 连接扫描

-sU，  UDP扫描

-sP，   ICMP扫描

-A，	目标系统全面扫描

--script=  扫描脚本



**john命令**

john --single        #破解傻瓜式密码

john					#字典暴力破解

john --wordlist=密码本   #使用自定义密码本

john --show						#显示破解的密码



**tcpdump命令**

-i 指定监控的网络接口

-A 转换ACSII码

-w 将数据包信息保存到指定的文件

-r 从指定文件读取数据包信息

-c 定义抓包的个数

**过滤条件**

类型： host、net、port、portrange

方向： src、dst

协议： tcp、udp、ip、wlan、arp

多个条件组合： and、or、not



**nginx安全**

nginx配置文件，隐藏版本信息：server_tokens off

nginx配置共享内存大小，限制访问： limit_req_zone $binary_remote_addr  zone=one:10m  rate=1r/s;



### iptables

- INPUT：数据包的目标地址是自己，则进入INPUT链
- OUTPUT:数据包的源地址是自己，则进入OUTPUT链
- FORWARD：数据包穿过自己，则进入FORWARD链





























# DBA



